name: Validate Action

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Validate action.yml syntax
        run: |
          echo "Validating action.yml..."
          # Check if file exists and is valid YAML
          if ! python3 -c "import yaml; yaml.safe_load(open('action.yml'))"; then
            echo "Error: action.yml is not valid YAML"
            exit 1
          fi
          echo "✅ action.yml is valid YAML"
      
      - name: Check required fields
        run: |
          echo "Checking required fields..."
          
          # Check for required top-level fields
          if ! grep -q "^name:" action.yml; then
            echo "Error: Missing 'name' field"
            exit 1
          fi
          
          if ! grep -q "^runs:" action.yml; then
            echo "Error: Missing 'runs' field"
            exit 1
          fi
          
          if ! grep -q "using: 'composite'" action.yml; then
            echo "Error: Expected composite action"
            exit 1
          fi
          
          echo "✅ All required fields present"
      
      - name: Lint bash scripts in action
        run: |
          echo "Checking bash scripts..."
          # Extract bash scripts and check for common issues
          # This is a basic check - consider adding shellcheck for more thorough linting
          if grep -q "shell: bash" action.yml; then
            echo "✅ Action uses bash shell"
          fi
